<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>LAN-Gymnasium online Klassenbuch</title>
<link rel="stylesheet" href="style/webpage.css" type="text/css">
</head>
<body>
	<script src="javascript/script.js"></script>
	<script src="javascript/jquery-2.1.4.min.js"></script>
	<script>
		var user;
		var userSchool;
		var footerEventCount;
		
		window.addEventListener("OnFooterLoaded", function(e) {
			if(footerEventCount >= 1){ 
				$('#footer_txt_logininfo').prepend(document.createTextNode('Angemeldet im ' + userSchool.name + ' als '));
				
				$('#footer_txt_logininfo').append(document.createTextNode(user.firstName + ' ' + user.familyName));
			}
			else{
				footerEventCount++;
			}
		})
		
		window.addEventListener("DOMContentLoaded", function(){
			footerEventCount=0;
			$.getJSON("/rest/user/loggedInUser", function(user) {
				setUser(user);
				var evt = new CustomEvent("OnFooterLoaded", {});
				window.dispatchEvent(evt);
			})
			
			$.getJSON("/rest/user/userSchool", function(school) {
				setUserSchool(school);
				var evt = new CustomEvent("OnFooterLoaded", {});
				window.dispatchEvent(evt);
			})
			
			getAllSchools();
		});
	
		function setUser(user){
			this.user = user;
		}
		
		function setUserSchool(school){
			this.userSchool = school;
		}
	 	
		function appendSchool(school){
			$('#maint_school_ddb_choose_school').append($('<option value=\"'+ school.key.id +'\">'+ school.name +'</option>'));
			$('#maint_class_ddb_school').append($('<option value=\"'+ school.key.id +'\">'+ school.name +'</option>'));
			$('#maint_teacher_ddb_choose_school').append($('<option value=\"'+ school.key.id +'\">'+ school.name +'</option>'));
			$('#maint_pupil_ddb_choose_school').append($('<option value=\"'+ school.key.id +'\">'+ school.name +'</option>'))
		}
	
		function getAllSchools(){
			$.getJSON("/rest/school", function(data) {
				$.each(data, function(index, school) {
					appendSchool(school);
				})
			})
		}
		
		function appendClazzFromSchool(clazz){
			$('#maint_class_ddb_choose_class').append($('<option value=\"'+ clazz.key.id +'\">'+ clazz.grade + clazz.letter +'</option>'));
		}
		
		function getClazzesFromSchool(){
		
			var schoolSelect = document.getElementById('maint_class_ddb_school');
			
			var filterSchool = schoolSelect.options[schoolSelect.selectedIndex].value;
	
			
			var filterObject = {schoolID:filterSchool, grade:null, letter:null, teacherID:null, studentID:null};
			
			$.ajaxSetup({
				  contentType: "application/json; charset=utf-8"
			});
			$.ajax({
				url: "/rest/filter/clazzes",
				contentType: "application/json; charset=utf-8",
				data: JSON.stringify(filterObject),
				success: function(data) {
					$('#maint_class_ddb_choose_class option').remove();
					$('#maint_class_ddb_choose_class').append('<option value="null" disabled selected hidden id="maint_ddb_default">Klasse w&aumlhlen</option>');
					$('#maint_class_ddb_choose_class').append('<option value="null" id="maint_ddb_new">Klasse registrieren</option>');
					$.each(data, function(index, clazz) { 
						appendClazzFromSchool(clazz);
					})
				},
				error: function() {
					getClazzesFromSchool();
				},
				method: "POST",
				mimeType: "application/json"
			});
		}
		
		function getClazzesFromClazz(){
			var clazzSelect = document.getElementById('maint_class_ddb_choose_class');
			
			var clazzID = clazzSelect.options[clazzSelect.selectedIndex].value;
			
			$.getJSON("/rest/clazz/"+clazzID, function(clazz) {
	 			$('#maint_ddb_class_grade').val(clazz.grade);
	 			$('#maint_ddb_class_token').val(clazz.letter);
			})
			
		
 		}
 
	</script>
	<header>
		<nav id="doc_navlist">
			<ul>
				<li></li>
				<li><a href="./mylan">MyLAN</a></li>
				<li><a href="./teachers">Lehrer</a></li>
				<li><a href="./classes">Klassen</a></li>
				<li><a href="./pupils">Sch&uuml;ler</a></li>
				<li id="current"><a href="./maint">Verwalten</a></li>
				<li></li>
				<li id="justifier"></li>
			</ul>
		</nav>
	</header>


	<div id="pagecontent">
		<div id="maintForm">
			<form>
				<div>
					<em id="maintSchoolsFormContentLn1">Schule</em> <select
						type="institution_ddb" id="maint_school_ddb_choose_school">

						<option value="null" disabled selected hidden
							id="maint_ddb_default">Schule w&aumlhlen</option>
						<option value="null" id="maint_ddb_new">Schule
							registrieren</option>


					</select>
					<!--input type="button" value="Neue Schule registrieren" id="maintSchoolsFormContentLn1" onclick="onclickRegisterSchool(this.form)"/-->
					<input type="button" value="Schule speichern"
						id="maintSchoolsFormContentLn1"
						onclick="onclickSaveSchool(this.form)" />
				</div>
				<div>
					<span id="maintSchoolsFormContentLn2"> <label
						for="maintFormField">Name</label> <input type="text"
						name="maintFormField" id="maint_inpt_instName" />
					</span> <span id="maintSchoolsFormContentLn2"> <label
						for="maintFormField">Vorname Initiallehrer</label> <input
						type="text" name="maintFormField"
						id="maint_inpt_instIniTeacher_fName" />
					</span> <span id="maintSchoolsFormContentLn2"> <label
						for="maintFormField">Nachame Initiallehrer</label> <input
						type="text" name="maintFormField"
						id="maint_inpt_instIniTeacher_lName" />
					</span>
				</div>
			</form>
		</div>
		<div id="maintForm">
			<form>
				<div>
					<em id="maintSchoolsFormContentLn1">Klasse der Schule </em> <span
						id="maintSchoolsFormContentLn2"> <select type="school_ddb"
						id="maint_class_ddb_school" onchange="getClazzesFromSchool()">
							<option value="null" disabled selected hidden id="">Schule
								w&aumlhlen</option>
					</select>
					</span> <select type="teacher_ddb" id="maint_class_ddb_choose_class" onchange="getClazzesFromClazz()">
						<option value="null" disabled selected hidden
							id="maint_ddb_default">Klasse w&aumlhlen</option>
						<option value="null" id="maint_ddb_new">Klasse
							registrieren</option>

					</select>
					<!--input type="button" value="Neue Klasse registrieren" id="maintSchoolsFormContentLn1" onclick="onclickRegisterClass(this.form)"/-->
					<input type="button" value="Klasse speichern"
						id="maintSchoolsFormContentLn1"
						onclick="onclickSaveClass(this.form)" />
				</div>
				<div>

					<!--span id="maintSchoolsFormContentLn2">
							<label for="maintFormField">Foto</label>
							<input type="text" name="maintFormField" id="maint_inpt_class_setPicturePath" />
						</span-->
					<span id="maintSchoolsFormContentLn2"> <label
						for="maintFormField">Stufe</label> <select type="class_grade_ddb"
						id="maint_ddb_class_grade">

							<option value="null" disabled selected hidden
								id="maint_ddb_default">Stufe w&aumlhlen</option>

							<option value="1">1</option>
							<option value="2">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">9</option>
							<option value="10">10</option>
							<option value="11">11</option>
							<option value="12">12</option>
							<option value="13">13</option>
					</select>
					</span> <span id="maintSchoolsFormContentLn2"> <label
						for="maintFormField">Buchstabe</label> <select
						type="class_grade_ddb" id="maint_ddb_class_token">

							<option value="null" disabled selected hidden
								id="maint_ddb_default">Buchstaben w&aumlhlen</option>

							<option value="a">a</option>
							<option value="b">b</option>
							<option value="c">c</option>
							<option value="d">d</option>
							<option value="e">e</option>
							<option value="f">f</option>
							<option value="g">g</option>
							<option value="h">h</option>
							<option value="i">i</option>
							<option value="j">j</option>
							<option value="k">k</option>
							<option value="l">l</option>
					</select>
					</span>
				</div>
			</form>
		</div>
		<div id="maintForm">
			<form>
				<div>
					<em id="maintSchoolsFormContentLn1">Lehrer</em> <select
						type="teacher_ddb" id="maint_teacher_ddb_choose_teacher">

						<option value="null" disabled selected hidden
							id="maint_ddb_default">Lehrer w&aumlhlen</option>
						<option value="null" id="maint_ddb_new">Lehrer
							registrieren</option>

					</select>
					<!--input type="button" value="Neuen Lehrer registrieren" id="maintSchoolsFormContentLn1" onclick="onclickRegisterTeacher(this.form)"/-->
					<input type="button" value="Lehrer speichern"
						id="maintSchoolsFormContentLn1"
						onclick="onclickSaveTeacher(this.form)" />
				</div>
				<div>
					<span id="maintSchoolsFormContentLn2"> <label
						for="maintFormField">Schule</label> <select type="school_ddb"
						id="maint_teacher_ddb_choose_school">

							<option value="null" disabled selected hidden
								id="maint_ddb_default">Schule w&aumlhlen</option>

					</select>
					</span>
					<!--span id="maintSchoolsFormContentLn2">
							<label for="maintFormField">Foto</label>
							<input type="text" name="maintFormField" id="maint_inpt_teacher_setPicturePath" />
						</span-->
					<span id="maintSchoolsFormContentLn2"> <label
						for="maintFormField">Vorname</label> <input type="text"
						name="maintFormField" id="maint_inpt_tFirstname" />
					</span> <span id="maintSchoolsFormContentLn2"> <label
						for="maintFormField">Nachname</label> <input type="text"
						name="maintFormField" id="maint_inpt_tLastname" />
					</span>
					<div id="maintClassesTable">
						<label for="maintFormField">Klasse</label>
						<div id="table">
							<table>
								<tr>
									<td id="header"></td>
									<td id="header">Klasse</td>
								</tr>
								<tr>
									<td id="maint_class_checkbox"><input type="checkbox"
										id="check1"></td>
									<td>1a</td>
								</tr>
								<tr>
									<td>[x]</td>
									<td>1b</td>
								</tr>
								<tr>
									<td>[ ]</td>
									<td>1c</td>
								</tr>
							</table>
						</div>
					</div>
				</div>
			</form>
		</div>
		<div id="maintForm">
			<em>Information</em>
			<ul>
				<li>Achtung! Nicht gesicherte &Aumlnderungen gehen verloren!</li>
				<li>Neue Lehrer/Schüler erhalten das Initialpasswort "1234".</li>
			</ul>
		</div>
		<div id="maintForm">
			<form>
				<div>
					<em id="maintSchoolsFormContentLn1">Schüler</em> <select
						type="pupil_ddb" id="maint_pupil_ddb_choose_pupil">

						<option value="null" disabled selected hidden
							id="maint_ddb_default">Sch&uumller w&aumlhlen</option>
						<option value="null" id="maint_ddb_new">Sch&uumller
							registrieren</option>

					</select>
					<!--input type="button" value="Neuen Schüler registrieren" id="maintSchoolsFormContentLn1" onclick="onclickRegisterPupil(this.form)"/-->
					<input type="button" value="Schüler speichern"
						id="maintSchoolsFormContentLn1"
						onclick="onclickSavePupil(this.form)" />
				</div>
				<div>
					<span id="maintSchoolsFormContentLn2"> <label
						for="maintFormField">Schule</label> <select type="school_ddb"
						id="maint_pupil_ddb_choose_school">

							<option value="null" disabled selected hidden
								id="maint_ddb_default">Schule w&aumlhlen</option>

					</select>
					</span>
					<!--span id="maintSchoolsFormContentLn2">
							<label for="maintFormField">Foto</label>
							<input type="text" name="maintFormField" id="maint_inpt_pupil_setPicturePath" />
						</span-->
					<span id="maintSchoolsFormContentLn2"> <label
						for="maintFormField">Vorname</label> <input type="text"
						name="maintFormField" id="maint_inpt_tFirstname" />
					</span> <span id="maintSchoolsFormContentLn2"> <label
						for="maintFormField">Nachname</label> <input type="text"
						name="maintFormField" id="maint_inpt_tLastname" />
					</span> <span id="maintSchoolsFormContentLn2"> <label
						for="maintFormField">Klasse</label> <select type="class_ddb"
						id="maint_pupil_ddb_choose_class">

							<option value="null" disabled selected hidden
								id="maint_ddb_default">Klasse w&aumlhlen</option>

					</select>
					</span>
				</div>
			</form>
		</div>
	</div>


	<footer>
		<div id="footer_logoutbar">
			<p id="footer_txt_logininfo"></p>
			<a href='logout' id="footer_a_logout">> Abmelden &lt;</a>
		</div>
	</footer>
</body>
</html>